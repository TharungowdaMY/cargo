from flask import Flask, request, jsonify
from pathlib import Path
import csv

app = Flask(__name__)
UPLOAD_DIR = Path(__file__).parent / 'uploads'
UPLOAD_DIR.mkdir(exist_ok=True)

@app.route('/upload_csv', methods=['POST'])
def upload_csv():
    file = request.files.get('file')
    if not file or file.filename == '':
        return 'No file uploaded', 400
    dest = UPLOAD_DIR / file.filename
    file.save(dest)
    with dest.open(newline='', encoding='utf-8') as f:
        reader = csv.DictReader(f)
        data = list(reader)
    return jsonify(data)